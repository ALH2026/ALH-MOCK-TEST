<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AISSEE Mock Test - Abhimanyu Learning Hub (Set 2)</title>

    <script>
        /* =========================
           TEST 2 – LOCK CONFIG
        ========================== */
        const TEST_LOCK_KEY = "ALH_TEST_2_LOCK";

        // STEP 2: Check lock on page load
        if (localStorage.getItem(TEST_LOCK_KEY) === "DONE") {
            document.addEventListener("DOMContentLoaded", () => {
                document.body.innerHTML = `
                    <div style="text-align:center;margin-top:120px;font-family:Segoe UI;">
                        <h2 style="color:red;">Test Already Attempted</h2>
                        <p>This mock test can be attempted only once.</p>
                        <p>Re-attempt is not allowed.</p>
                    </div>
                `;
            });
        }
    </script>

    <style>
        :root { --primary: #1a237e; --secondary: #c62828; --bg: #f4f4f9; }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; user-select: none; }
        #watermark { position: fixed; bottom: 20px; right: 20px; opacity: 0.15; font-weight: bold; color: var(--primary); z-index: 1000; pointer-events: none; }
        .container { width: 100%; max-width: 850px; background: white; padding: 35px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative; }
        header { border-bottom: 3px solid var(--primary); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; }
        .timer { color: var(--secondary); font-weight: bold; font-size: 22px; background: #ffebee; padding: 5px 15px; border-radius: 8px; }
        .screen { display: none; }
        .screen.active { display: block; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: 600; }
        .diag-box { text-align: center; margin: 20px 0; padding: 15px; background: #fff; border: 1px solid #ddd; border-radius: 10px; }
        .question-text { font-size: 20px; margin-bottom: 25px; font-weight: 600; color: #333; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option { padding: 15px; border: 2px solid #eee; border-radius: 10px; cursor: pointer; transition: 0.2s; font-size: 17px; background: #fff; }
        .option:hover { border-color: var(--primary); background: #f0f2ff; }
        .section-tag { background: var(--secondary); color: white; padding: 5px 12px; border-radius: 5px; font-size: 14px; text-transform: uppercase; font-weight: bold; }
        .progress-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    </style>
</head>

<body oncontextmenu="return false;">

<div id="watermark">© Abhimanyu Learning Hub (ALH)</div>

<div class="container">
    <div id="welcome-screen" class="screen active">
        <h1 style="color: var(--primary); margin-bottom: 5px;">AISSEE Mock Test Paper</h1>
        <p style="color: #666; margin-top: 0;">Abhimanyu Learning Hub | Set 2</p>
        <div style="margin: 40px 0;">
            <label style="font-weight: bold; display: block; margin-bottom: 10px;">Full Name:</label>
            <input type="text" id="user-name" style="width:100%; padding:15px; border:2px solid #ccc; border-radius:8px; font-size: 18px;" placeholder="Enter your name here">
        </div>
        <button class="btn" onclick="showScreen('instruction-screen')">Next Step</button>
    </div>

    <div id="instruction-screen" class="screen">
        <h2 style="color: var(--secondary);">Test Instructions</h2>
        <ul style="line-height: 2; font-size: 17px;">
            <li>Total Questions: 125</li>
            <li>Total Marks: 300</li>
            <li>Duration: 2 Hours 30 Minutes</li>
            <li>No Negative Marking</li>
        </ul>
        <button class="btn" onclick="startExam()">Start Test</button>
    </div>

    <div id="exam-screen" class="screen">
        <header>
            <div id="section-label"></div>
            <div class="timer" id="timer-display">150:00</div>
        </header>
        <div class="progress-bar"><div id="progress-fill"></div></div>
        <div id="diagram-area" class="diag-box" style="display:none"></div>
        <div class="question-text" id="q-text"></div>
        <div class="options-grid" id="options-area"></div>
        <p style="margin-top:20px; color:#777">Progress: <span id="current-count">1</span> / 125</p>
    </div>

    <div id="result-screen" class="screen">
        <h1 style="color: var(--primary)">Performance Report</h1>
        <h3 id="res-name"></h3>
        <div style="font-size: 32px; font-weight: bold; color: var(--secondary); margin: 20px 0;">
            Grand Total: <span id="res-score">0</span> / 300
        </div>
        <table>
            <thead><tr><th>Section</th><th>Marks</th></tr></thead>
            <tbody id="res-body"></tbody>
        </table>
        <button class="btn" style="margin-top:30px" onclick="window.print()">Print Results</button>
    </div>
</div>

<script>
    document.addEventListener('keydown', e => {
        if (e.ctrlKey && ['c','v','u','s'].includes(e.key.toLowerCase())) e.preventDefault();
    });

    const sections = ["Mathematics", "Intelligence & Reasoning", "English", "General Knowledge"];
    const _db = [ /* QUESTION DATABASE UNCHANGED */ ];

    let currentQ = 0, scoreArr = [0,0,0,0], timer, timeLeft = 150 * 60;

    function showScreen(id) {
        if (id === 'instruction-screen' && !document.getElementById('user-name').value)
            return alert("Enter candidate name!");

        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');

        if (id === 'instruction-screen')
            localStorage.setItem("ALH_TEST_2_NAME", document.getElementById('user-name').value);
    }

    function startExam() {
        showScreen('exam-screen');
        renderQ();
        timer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            document.getElementById('timer-display').innerText = `${m}:${s<10?'0':''}${s}`;
            if (timeLeft <= 0) finalize();
        }, 1000);
    }

    function renderQ() {
        const d = _db[currentQ];
        document.getElementById('section-label').innerHTML =
            `<span class="section-tag">${sections[d.s]}</span>`;
        document.getElementById('progress-fill').style.width = `${(currentQ/125)*100}%`;
        document.getElementById('current-count').innerText = currentQ + 1;
        document.getElementById('q-text').innerText = d.q;

        const diag = document.getElementById('diagram-area');
        diag.style.display = d.d ? 'block' : 'none';
        diag.innerHTML = d.d || '';

        const area = document.getElementById('options-area');
        area.innerHTML = '';
        d.o.forEach((opt, i) => {
            const btn = document.createElement('div');
            btn.className = 'option';
            btn.innerText = opt;
            btn.onclick = () => {
                if (i === d.a) scoreArr[d.s] += (d.s === 0 ? 3 : 2);
                currentQ++;
                currentQ < 125 ? renderQ() : finalize();
            };
            area.appendChild(btn);
        });
    }

    function finalize() {
        clearInterval(timer);

        // STEP 3: LOCK TEST AFTER SUBMIT
        localStorage.setItem(TEST_LOCK_KEY, "DONE");
        localStorage.setItem("ALH_TEST_2_SCORE", JSON.stringify(scoreArr));

        showResults();
    }

    function showResults() {
        showScreen('result-screen');
        document.getElementById('res-name').innerText =
            "Candidate: " + localStorage.getItem("ALH_TEST_2_NAME");

        const s = JSON.parse(localStorage.getItem("ALH_TEST_2_SCORE") || "[0,0,0,0]");
        document.getElementById('res-score').innerText = s.reduce((a,b)=>a+b,0);
        document.getElementById('res-body').innerHTML =
            sections.map((n,i)=>`<tr><td>${n}</td><td>${s[i]}</td></tr>`).join('');
    }
</script>
</body>
</html>
